"use strict";(()=>{var e={};e.id=70,e.ids=[70],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},6162:e=>{e.exports=require("stream")},4026:e=>{e.exports=require("string_decoder")},8061:e=>{e.exports=require("node:assert")},2761:e=>{e.exports=require("node:async_hooks")},2254:e=>{e.exports=require("node:buffer")},27:e=>{e.exports=require("node:console")},6005:e=>{e.exports=require("node:crypto")},5714:e=>{e.exports=require("node:diagnostics_channel")},604:e=>{e.exports=require("node:dns")},5673:e=>{e.exports=require("node:events")},3977:e=>{e.exports=require("node:fs/promises")},8849:e=>{e.exports=require("node:http")},2725:e=>{e.exports=require("node:http2")},7503:e=>{e.exports=require("node:net")},9411:e=>{e.exports=require("node:path")},8846:e=>{e.exports=require("node:perf_hooks")},5815:e=>{e.exports=require("node:querystring")},5467:e=>{e.exports=require("node:sqlite")},4492:e=>{e.exports=require("node:stream")},2332:e=>{e.exports=require("node:timers")},1764:e=>{e.exports=require("node:tls")},7261:e=>{e.exports=require("node:util")},3746:e=>{e.exports=require("node:util/types")},4086:e=>{e.exports=require("node:worker_threads")},5628:e=>{e.exports=require("node:zlib")},779:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>b,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p});var a={};r.r(a),r.d(a,{GET:()=>c,runtime:()=>u});var s=r(9303),i=r(8716),n=r(670),o=r(7070),l=r(302),d=r(5573);let u="nodejs";async function c(e){let t=`req-${Date.now()}-${Math.random().toString(36).substring(7)}`;try{let r,a;let s=e.nextUrl.searchParams,i=s.get("date"),n="1"===s.get("debug");if(!i)return o.NextResponse.json({ok:!1,error:"date parameter is required (YYYY-MM-DD)"},{status:400});if(!/^\d{4}-\d{2}-\d{2}$/.test(i))return o.NextResponse.json({ok:!1,error:"Invalid date format. Use YYYY-MM-DD"},{status:400});let u=await (0,d.A)(),c=((e,t)=>{if(0===t.length)return e;let r=new Date(e),a=null,s=1/0;if(t.includes(e))return e;for(let e of t){let t=new Date(e),i=Math.abs(t.getTime()-r.getTime());i<s&&(s=i,a=e)}return a||e})(i,u);console.log(`[${t}] Fetching factors for date: ${i} -> actual: ${c}`);try{if(!(r=await (0,d.v)(c,u)).rawText)throw Error("rawText not available in H41Report")}catch(r){let e=r instanceof Error?r.message:String(r);return console.error(`[${t}] Failed to fetch H.4.1 report:`,e),o.NextResponse.json({ok:!1,error:`Failed to fetch H.4.1 report: ${e}`,...n&&{date:i,actualReleaseDate:c}},{status:500})}try{a=await (0,l.parseFactorsTable1)(r.rawText,r.sourceUrl),n&&console.log(`[${t}] Factors parsed:`,{supplyingCount:a.supplying.length,absorbingCount:a.absorbing.length,totalSupplying:a.totals.totalSupplying.value,totalAbsorbing:a.totals.totalAbsorbingExReserves.value,reserveBalances:a.totals.reserveBalances.value,integrity:a.integrity})}catch(r){let e=r instanceof Error?r.message:String(r);return console.error(`[${t}] Failed to parse Table 1:`,e),o.NextResponse.json({ok:!1,error:`Failed to parse Factors Table 1: ${e}`,...n&&{date:i,actualReleaseDate:c,stack:r instanceof Error?r.stack:void 0}},{status:500})}return o.NextResponse.json({ok:!0,...a},{headers:{"Cache-Control":"public, s-maxage=21600, stale-while-revalidate=86400"}})}catch(e){return console.error(`[${t}] Error in factors route:`,e),o.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/h41/factors/route",pathname:"/api/h41/factors",filename:"route",bundlePath:"app/api/h41/factors/route"},resolvedPagePath:"C:\\Users\\Dick\\FED_h.4.1\\h41-dashboard\\app\\api\\h41\\factors\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:p,serverHooks:g}=f,m="/api/h41/factors/route";function b(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:p})}},5573:(e,t,r)=>{r.d(t,{A:()=>c,v:()=>u});var a=r(917);let s=[{key:"ⓐ",title:"재무부 일반계정 (TGA)",fedLabel:"U.S. Treasury, General Account",liquidityTag:"흡수(약재)",isCore:!0},{key:"ⓑ",title:"역리포 (RRP)",fedLabel:"Reverse repurchase agreements",liquidityTag:"흡수(약재)",isCore:!0},{key:"ⓒ",title:"통화발행 (현금)",fedLabel:"Currency in circulation",liquidityTag:"흡수(약재)"},{key:"ⓓ",title:"기타 부채\xb7자본",fedLabel:"Other liabilities and capital",liquidityTag:"흡수(약재)"},{key:"ⓔ",title:"리포 (Repo)",fedLabel:"Repurchase agreements",liquidityTag:"공급(해열)",isCore:!0},{key:"ⓕ",title:"Primary Credit",fedLabel:"Primary credit",liquidityTag:"공급(해열)",isCore:!0},{key:"ⓖ",title:"달러 스왑 (중앙은행)",fedLabel:"Central bank liquidity swaps",liquidityTag:"공급(해열)"},{key:"ⓗ",title:"보유증권 총계",fedLabel:"Securities held outright",liquidityTag:"QT/자산",isCore:!0},{key:"ⓘ",title:"미국 국채 보유 (UST)",fedLabel:"U.S. Treasury securities",liquidityTag:"QT/자산"},{key:"ⓙ",title:"MBS 보유",fedLabel:"Mortgage-backed securities",liquidityTag:"QT/자산"},{key:"ⓚ",title:"지준금 (Reserve balances)",fedLabel:"Reserve balances with Federal Reserve Banks",liquidityTag:"상태",isCore:!0},{key:"ⓛ",title:"Fed 자산 총규모 (Reserve Bank credit)",fedLabel:"Reserve Bank credit",liquidityTag:"상태"},{key:"ⓜ",title:"기타 예치금 (지준금 제외)",fedLabel:"Deposits with F.R. Banks, other than reserve balances",liquidityTag:"상태"},{key:"ⓝ",title:"흡수 총합 (지준금 제외)",fedLabel:"Total factors, other than reserve balances,",liquidityTag:"상태"}],i=["U.S. Treasury, General Account","Reverse repurchase agreements","Reserve balances with Federal Reserve Banks","Securities held outright","Repurchase agreements","Primary credit"];function n(e,t){return e.includes("Treasury")&&e.includes("General Account")?"재무부 일반계정(TGA)은 정부가 징수한 세금과 국채 발행 자금을 보관하는 계정입니다.":e.includes("Reverse repurchase")?"역리포(RRP)는 금융기관이 연준에 단기 자금을 예치하는 수단입니다.":e.includes("Repurchase agreements")&&!e.includes("Reverse")?"리포(Repo)는 연준이 금융기관에 단기 자금을 공급하는 수단입니다.":e.includes("Primary credit")?"Primary Credit은 은행들이 연준으로부터 직접 차입하는 융자입니다.":e.includes("Securities held outright")?"보유증권 총계는 연준이 보유한 국채와 MBS의 총액입니다.":e.includes("Reserve balances")?"지준금(Reserve balances)은 은행들이 연준에 예치한 준비금입니다.":""}async function o(){let e=new Date,t=Math.ceil(e.getDate()/7),r=e.getMonth()+1,a=["이번 주는 연준의 통화정책 방향성에 대한 시장의 관심이 높아진 가운데","최근 금리 변동성과 자금 시장의 스트레스 지표를 고려할 때","주요 경제 지표와 인플레이션 데이터를 종합하면","금융 시장의 리스크 선호도 변화와 함께","글로벌 유동성 환경과 달러 강세를 고려하면"];return{weekNumber:t,month:r,context:a[t%a.length]}}async function l(e,t){let r=e.change_musd;return 0===r?"현재 상태 유지 중입니다.":r>0?`${t.context} 이 지표가 증가하고 있어요.`:`${t.context} 이 지표가 감소하고 있어요.`}async function d(e,t){let r=e("body").text().replace(/\r/g,""),a=r.split("\n").map(e=>e.replace(/\u00a0/g," ").trim()).filter(Boolean),d=(a.find(e=>e.startsWith("Release Date:"))??"Release Date: (unknown)").replace("Release Date:","").trim(),u="(unknown)";for(let e=0;e<a.length;e++){let t=a[e];if("Week ended"===t&&e+1<a.length){let t=a[e+1];if(!t.toLowerCase().includes("change from")&&t.match(/[A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4}/)){u=t.trim();break}}if(t.includes("Week ended")&&!t.toLowerCase().includes("change from")){let e=t.match(/Week\s+ended\s+([A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4})/i);if(e){u=e[1].trim();break}}if(t.includes("Week ending")&&!t.toLowerCase().includes("change from")){let e=t.match(/Week\s+ending\s+([A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4})/i);if(e){u=e[1].trim();break}}if(t.includes("As of")&&t.match(/[A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4}/)){let e=t.match(/As\s+of\s+([A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4})/i);if(e){u=e[1].trim();break}}}if("(unknown)"===u){let t=e("body").text();for(let e of[/Week\s+ended\s+([A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4})/i,/Week\s+ending\s+([A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4})/i,/As\s+of\s+([A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4})/i]){let r=t.match(e);if(r&&r[1]){u=r[1].trim();break}}}console.log("[parseH41Report] Week ended date found:",u);let c=await o(),f=await Promise.all(s.map(async e=>{let t=function(e,t){let r=e.findIndex(e=>e===t);if(r>=0)return r;let a=t.toLowerCase();if((r=e.findIndex(e=>e.toLowerCase()===a))>=0)return r;let s=t.toLowerCase().split(/[,\s]+/).filter(e=>e.length>3);for(let t=0;t<e.length;t++){let r=e[t].toLowerCase();if(s.every(e=>r.includes(e)))return t}return t.includes("Reverse repurchase")&&(r=e.findIndex(e=>e.toLowerCase().includes("reverse")&&(e.toLowerCase().includes("repo")||e.toLowerCase().includes("repurchase"))))>=0||t.includes("Repurchase agreements")&&!t.includes("Reverse")&&(r=e.findIndex(e=>e.toLowerCase().includes("repurchase")&&!e.toLowerCase().includes("reverse")))>=0||t.includes("Securities held outright")&&(r=e.findIndex(e=>e.toLowerCase().includes("securities")&&e.toLowerCase().includes("held")&&e.toLowerCase().includes("outright")))>=0?r:-1}(a,e.fedLabel);if(t<0)return{key:e.key,title:e.title,fedLabel:e.fedLabel,balance_musd:0,change_musd:0,balance_okeusd:0,change_okeusd:0,liquidityTag:e.liquidityTag,concept:n(e.fedLabel,e.liquidityTag),interpretation:"파싱 실패: H.4.1 페이지 구조 변경 가능성이 있습니다.",dataDate:u,qtQeSignal:"중립"};let r=0,s=0;for(let e=1;e<=5;e++)if(t+e<a.length){let i=function(e){let t=e.replace(/\u00a0/g," ").trim();if(!t)return null;let r=t.match(/^([+-])?\s*([\d,]+)$/);if(!r)return null;let a="-"===r[1]?-1:1,s=Number(r[2].replace(/,/g,""));return Number.isFinite(s)?a*s:null}(a[t+e]);if(null!==i){if(0===r)r=i;else if(0===s){s=i;break}}}let i=n(e.fedLabel,e.liquidityTag),o=await l({liquidityTag:e.liquidityTag,title:e.title,fedLabel:e.fedLabel,change_musd:s,balance_musd:r},c),d=function(e,t){if(e.includes("Securities held outright")){if(t<-2e4)return"QT";if(t>2e4)return"QE"}return"중립"}(e.fedLabel,s);return{key:e.key,title:e.title,fedLabel:e.fedLabel,balance_musd:r,change_musd:s,balance_okeusd:r/100,change_okeusd:s/100,liquidityTag:e.liquidityTag,concept:i,interpretation:o,dataDate:u,qtQeSignal:d}})),h=f.filter(e=>i.includes(e.fedLabel)),p=0,g=f.find(e=>"U.S. Treasury, General Account"===e.fedLabel),m=f.find(e=>"Reverse repurchase agreements"===e.fedLabel),b=f.find(e=>"Reserve balances with Federal Reserve Banks"===e.fedLabel);g&&g.change_musd>5e4&&(p=Math.max(p,1)),m&&m.change_musd>3e4&&(p=Math.max(p,1)),b&&b.change_musd<-5e4&&(p=Math.max(p,1));let y=r||e("body").text().replace(/\r/g,"");return{releaseDateText:d,asOfWeekEndedText:u,sourceUrl:t,cards:f,updatedAtISO:new Date().toISOString(),warningLevel:p,assetGuidance:"유동성 환경을 분석하여 자산군 대응 방향을 제시합니다.",teamSignal:{blueTeam:"비중 확대 가능",whiteTeam:"기본 유지",summary:"청팀 우호적 환경 \xb7 백팀 중립"},weeklySummary:"주간 요약 리포트입니다.",coreCards:h,rawText:y}}async function u(e,t){let r="https://www.federalreserve.gov/releases/h41/current/";if(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))throw Error(`Invalid date format: ${e}`);let[t]=e.split("-");if(2023>parseInt(t,10))throw Error(`Archive date detected: ${e}`);let a=function(e){let t=e.split("-");if(3!==t.length)throw Error(`Invalid ISO date format: ${e}`);let[r,a,s]=t;return`${r}${a}${s}`}(e);r=`https://www.federalreserve.gov/releases/h41/${a}/default.htm`}let s=await fetch(r,{headers:{"user-agent":"h41-dashboard/1.0 (+cursor)"},cache:"no-store"});if(!s.ok)throw Error(`Failed to fetch H.4.1: ${s.status} ${s.statusText}`);let i=await s.text();if(e&&i.length<500)throw Error(`Failed to fetch H.4.1 archive for date ${e}`);let n=a.zD(i),o=await d(n,r);if(!o.cards.some(e=>0!==e.balance_musd||0!==e.change_musd))throw Error(`Parsed H.4.1 data appears invalid (all zeros) for ${r}`);return o}async function c(){try{let e=await fetch("https://www.federalreserve.gov/feeds/h41.html",{headers:{"User-Agent":"h41-dashboard/1.0"},cache:"no-store"});if(!e.ok)return[];let t=await e.text(),r=[],a=new Set;for(let e of[/\/releases\/h41\/(\d{8})\//g,/\/h41\/(\d{8})\//g]){let s;for(;null!==(s=e.exec(t));){let e=s[1],t=e.substring(0,4),i=e.substring(4,6),n=e.substring(6,8),o=`${t}-${i}-${n}`,l=parseInt(t),d=new Date().getFullYear()-2;l>=d&&l<=2100&&!a.has(o)&&(r.push(o),a.add(o))}}return r.sort((e,t)=>t.localeCompare(e)),r}catch(e){return console.warn("Error fetching release dates:",e),[]}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,917,302],()=>r(779));module.exports=a})();