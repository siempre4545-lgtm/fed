"use strict";(()=>{var e={};e.id=275,e.ids=[275],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},6162:e=>{e.exports=require("stream")},4026:e=>{e.exports=require("string_decoder")},8061:e=>{e.exports=require("node:assert")},2761:e=>{e.exports=require("node:async_hooks")},2254:e=>{e.exports=require("node:buffer")},27:e=>{e.exports=require("node:console")},6005:e=>{e.exports=require("node:crypto")},5714:e=>{e.exports=require("node:diagnostics_channel")},604:e=>{e.exports=require("node:dns")},5673:e=>{e.exports=require("node:events")},3977:e=>{e.exports=require("node:fs/promises")},8849:e=>{e.exports=require("node:http")},2725:e=>{e.exports=require("node:http2")},7503:e=>{e.exports=require("node:net")},9411:e=>{e.exports=require("node:path")},8846:e=>{e.exports=require("node:perf_hooks")},5815:e=>{e.exports=require("node:querystring")},5467:e=>{e.exports=require("node:sqlite")},4492:e=>{e.exports=require("node:stream")},2332:e=>{e.exports=require("node:timers")},1764:e=>{e.exports=require("node:tls")},7261:e=>{e.exports=require("node:util")},3746:e=>{e.exports=require("node:util/types")},4086:e=>{e.exports=require("node:worker_threads")},5628:e=>{e.exports=require("node:zlib")},891:(e,a,t)=>{t.r(a),t.d(a,{originalPathname:()=>S,patchFetch:()=>x,requestAsyncStorage:()=>R,routeModule:()=>L,serverHooks:()=>D,staticGenerationAsyncStorage:()=>P});var r={};t.r(r),t.d(r,{GET:()=>_,dynamic:()=>C,revalidate:()=>k,runtime:()=>T});var l=t(9303),n=t(8716),s=t(670),o=t(7070);let c={"Reserve Bank credit":"연준 신용","Securities held outright":"보유 증권","U.S. Treasury securities":"국채","Mortgage-backed securities":"MBS","Agency debt securities":"기관채","Currency in circulation":"유통 통화","Reverse repurchase agreements":"역레포","U.S. Treasury, General Account":"재무부 일반계정(TGA)","Reserve balances with Federal Reserve Banks":"지급준비금","Total assets":"총 자산","Total liabilities":"총 부채","Factors supplying reserve funds":"공급 요인","Factors absorbing reserve funds":"흡수 요인","Repurchase agreements":"리포","Primary credit":"Primary Credit","Other Federal Reserve assets":"기타 연준 자산","Treasury cash holdings":"재무부 현금 보유","Deposits with F.R. Banks, other than reserve balances":"기타 예치금","Treasury deposits with Federal Reserve Banks":"재무부 예치금","Other liabilities and capital":"연준 예치금",Deposits:"연준 예치금","Within 15 days":"15일 이내","16 days to 90 days":"16-90일","91 days to 1 year":"91일-1년","Over 1 year to 5 years":"1-5년","Over 5 years to 10 years":"5-10년","Over 10 years":"10년 이상","Secondary credit":"Secondary Credit","Seasonal credit":"Seasonal Credit","Bank Term Funding Program":"BTFP","Other credit extensions":"기타 신용 연장","Overnight securities lending":"일일 증권 대출",Boston:"보스턴","New York":"뉴욕",Philadelphia:"필라델피아",Cleveland:"클리블랜드",Richmond:"리치먼드",Atlanta:"애틀랜타",Chicago:"시카고","St. Louis":"세인트루이스",Minneapolis:"미니애폴리스","Kansas City":"캔자스시티",Dallas:"댈러스","San Francisco":"샌프란시스코"};function i(e){if(c[e])return c[e];for(let[a,t]of Object.entries(c))if(e.includes(a))return e.replace(a,t);return e}function u(e,a,t,r){try{let l=new Date(a),n=new Date(l);n.setDate(n.getDate()-364);let s=n.getTime(),o=null,c=1/0;for(let e of t){let a=new Date(e.date).getTime(),t=Math.abs(a-s);t<=12096e5&&t<c&&(c=t,o=e)}if(!o)return console.warn(`[calculateYearlyChange] No historical data found for ${r} (target: ${n.toISOString().split("T")[0]})`),{change:0,changePercent:0};let i=0;if("Total Supplying Factors"===r||"Total Absorbing Factors"===r||"Reserve Balances"===r){let e=o.cards.find(e=>e.fedLabel===r);if(!e)return console.warn(`[calculateYearlyChange] Card not found for ${r} in historical data`),{change:0,changePercent:0};i=e.balance_musd}else{let e=o.cards.find(e=>e.fedLabel===r);if(!e)return console.warn(`[calculateYearlyChange] Card not found for ${r} in historical data (date: ${o.date})`),{change:0,changePercent:0};i=e.balance_musd}if(0===i)return console.warn(`[calculateYearlyChange] Past value is 0 for ${r}`),{change:0,changePercent:0};let u=e-i,d=u/i*100;return console.log(`[calculateYearlyChange] ${r}:`,{currentValue:e,pastValue:i,change:u,changePercent:d.toFixed(2),historicalDate:o.date}),{change:u,changePercent:d}}catch(e){return console.error(`[calculateYearlyChange] Error for ${r}:`,e),{change:0,changePercent:0}}}function d(e,a,t){let r={"15일↓":0,"16-90일":0,"91일-1년":0,"1-5년":0,"5-10년":0,"10년↑":0};for(let t=a;t<Math.min(a+10,e.length);t++){let a=h(e[t]);if(a.length>=6){r["15일↓"]=a[0]||0,r["16-90일"]=a[1]||0,r["91일-1년"]=a[2]||0,r["1-5년"]=a[3]||0,r["5-10년"]=a[4]||0,r["10년↑"]=a[5]||0;break}}let l=Object.values(r).reduce((e,a)=>e+a,0);return{label:t,buckets:r,total:l}}function h(e){let a;let t=[],r=/([+-]?[\d,]+)/g;for(;null!==(a=r.exec(e));){let e=parseInt(a[1].replace(/,/g,""),10);isNaN(e)||t.push(e)}return t}function g(e,a){for(let t of a){let a=e.toLowerCase().indexOf(t.toLowerCase());if(-1===a)continue;let r=h(e.substring(a,a+500));if(r.length>=2)return{value:r[0],change:r[1]}}return null}var b=t(2896);async function f(e,a){let t=[];try{let r=new Date(e),l=new Date(r);l.setDate(l.getDate()-364);let n=new Date(r);n.setDate(n.getDate()-7);let s=e=>{let t=null,r=1/0;for(let l of a){let a=new Date(l),n=Math.abs(a.getTime()-e.getTime());n<=12096e5&&n<r&&(r=n,t=l)}return t},o=s(l);if(o)try{console.log(`[fetchHistoricalData] Fetching 52 weeks ago data for ${o}`);let e=await (0,b.v9)(o,a);t.push({date:o,weekEnded:w(e.asOfWeekEndedText,o),cards:e.cards.map(e=>({fedLabel:e.fedLabel,balance_musd:e.balance_musd,change_musd:e.change_musd}))})}catch(e){console.warn(`[fetchHistoricalData] Failed to fetch year ago data for ${o}:`,e)}let c=s(n);if(c&&c!==e)try{console.log(`[fetchHistoricalData] Fetching previous week data for ${c}`);let e=await (0,b.v9)(c,a);t.push({date:c,weekEnded:w(e.asOfWeekEndedText,c),cards:e.cards.map(e=>({fedLabel:e.fedLabel,balance_musd:e.balance_musd,change_musd:e.change_musd}))})}catch(e){console.warn(`[fetchHistoricalData] Failed to fetch week ago data for ${c}:`,e)}console.log(`[fetchHistoricalData] Loaded ${t.length} historical data points`)}catch(e){console.error("[fetchHistoricalData] Error fetching historical data:",e)}return t}async function y(e,a,t){let r=[];try{r=await (0,b.AU)(),console.log(`[convertH41ToH4Report] Loaded ${r.length} release dates`)}catch(e){console.warn("[convertH41ToH4Report] Failed to load release dates:",e)}let l=await f(a,r),n=await v(e,a,l),s=await p(e,a,l,r,n),o=function(e){let a=e.cards,t=a.find(e=>e.fedLabel.toLowerCase().includes("loans")&&!e.fedLabel.toLowerCase().includes("total")),r=a.find(e=>e.fedLabel.toLowerCase().includes("central bank liquidity swaps")||e.fedLabel.toLowerCase().includes("swaps")),l=[];t&&l.push({label:i(t.fedLabel),value:t.balance_musd,change:t.change_musd}),r&&l.push({label:i(r.fedLabel),value:r.balance_musd,change:r.change_musd});let n=a.find(e=>"Other liabilities and capital"===e.fedLabel||e.fedLabel.toLowerCase().includes("deposits")),s=[];return n&&s.push({label:"Other liabilities and capital"===n.fedLabel?"연준 예치금":i(n.fedLabel),value:n.balance_musd,change:n.change_musd}),{keySupply:l,keyAbsorb:s}}(e),c=e.rawText||"",u=function(e,a){let t=function(e){let a=[],t=e.indexOf("Maturity Distribution");if(-1===t)return a;let r=e.indexOf("Table 3",t),l=(-1!==r?e.substring(t,r):e.substring(t)).split("\n").map(e=>e.trim()).filter(Boolean),n=null,s=null;for(let e=0;e<l.length;e++){let a=l[e].toLowerCase();(a.includes("treasury")||a.includes("u.s. treasury"))&&!n&&(n=d(l,e,"미 국채")),(a.includes("mbs")||a.includes("mortgage-backed"))&&!s&&(s=d(l,e,"MBS"))}return n&&a.push(n),s&&a.push(s),a}(a),r=[],l=[];for(let e of t){let a={"15일↓":e.buckets["15일↓"],"16-90일":e.buckets["16-90일"],"91일-1년":e.buckets["91일-1년"],"1-5년":e.buckets["1-5년"],"5-10년":e.buckets["5-10년"],"10년↑":e.buckets["10년↑"]};l.push({label:e.label,buckets:a,total:e.total}),"미 국채"===e.label&&Object.entries(a).forEach(([a,t])=>{r.push({range:a,value:t,percent:e.total>0?t/e.total*100:0})})}return{buckets:r,tableRows:l}}(0,c),y=function(e,a){let t=e.cards,r=e=>t.find(a=>a.fedLabel.toLowerCase().includes(e.toLowerCase())),l=function(e){let a=[],t=g(e,["Primary credit","Primary Credit"]);t&&a.push({label:"1차 신용",value:t.value,change:t.change});let r=g(e,["Bank Term Funding Program","BTFP"]);r&&a.push({label:"은행기간대출",value:r.value,change:r.change});let l=g(e,["Total loans","Total Loans"]);return l&&a.push({label:"대출 합계",value:l.value,change:l.change}),a}(a),n=[];if(l.length>0)n.push(...l.map(e=>({label:e.label,value:e.value,change:e.change})));else{let e=r("Primary credit");e&&n.push({label:"1차 신용",value:e.balance_musd,change:e.change_musd});let a=r("Bank Term Funding Program")||r("BTFP");a&&n.push({label:"은행기간대출",value:a.balance_musd,change:a.change_musd});let t=n.reduce((e,a)=>e+a.value,0);t>0&&n.push({label:"대출 합계",value:t,change:n.reduce((e,a)=>e+a.change,0)})}let s=function(e){let a=[],t=g(e,["Overnight","overnight securities lending"]);t&&a.push({label:"익일물",value:t.value,change:t.change,description:"다음 영업일 만기"});let r=g(e,["Term","term securities lending"]);return r&&a.push({label:"기간물",value:r.value,change:r.change,description:"특정 기간 지정"}),a}(a),o=[];return s.length>0&&o.push(...s.map(e=>({label:e.label,value:e.value,change:e.change}))),{loansTable:n,securitiesLendingTable:o}}(e,c),m=function(e,a){let t=e.cards,r=e=>t.find(a=>a.fedLabel.toLowerCase().includes(e.toLowerCase())),l=function(e){let a=[],t=[],r=e.toLowerCase().indexOf("assets");if(-1!==r){let t=e.substring(r,r+2e3);for(let{search:e,label:r}of[{search:["Gold","gold"],label:"금"},{search:["SDR","sdr"],label:"SDR"},{search:["Securities","securities held"],label:"보유 증권"},{search:["Repos","Repurchase agreements"],label:"레포"},{search:["Loans","Total loans"],label:"대출"},{search:["Swaps","Central bank liquidity swaps"],label:"통화스왑"},{search:["Total assets","Total Assets"],label:"총 자산"}]){let l=g(t,e);l&&a.push({label:r,value:l.value,weeklyChange:l.change,yearlyChange:0})}}let l=e.toLowerCase().indexOf("liabilities");if(-1!==l){let a=e.substring(l,l+2e3);for(let{search:e,label:r}of[{search:["F.R. Notes","Federal Reserve Notes"],label:"연방준비권"},{search:["Reverse Repos","Reverse repurchase"],label:"역레포"},{search:["Deposits","Deposits with"],label:"예금"},{search:["Reserves","Reserve balances"],label:"지급준비금"},{search:["TGA","Treasury, General Account"],label:"TGA"},{search:["Total liabilities","Total Liabilities"],label:"총 부채"}]){let l=g(a,e);l&&t.push({label:r,value:l.value,weeklyChange:l.change,yearlyChange:0})}}return{assets:a,liabilities:t}}(a),n=[];if(l.assets.length>0)n.push(...l.assets.map(e=>({label:e.label,value:e.value,change:e.weeklyChange})));else{let e=r("Gold");e&&n.push({label:"금",value:e.balance_musd,change:e.change_musd});let a=r("SDR");a&&n.push({label:"SDR",value:a.balance_musd,change:a.change_musd});let t=r("Securities held outright");t&&n.push({label:"보유 증권",value:t.balance_musd,change:t.change_musd});let l=r("Repurchase agreements");l&&n.push({label:"레포",value:l.balance_musd,change:l.change_musd});let s=r("Loans")||r("Primary credit");s&&n.push({label:"대출",value:s.balance_musd,change:s.change_musd});let o=r("Central bank liquidity swaps");o&&n.push({label:"통화스왑",value:o.balance_musd,change:o.change_musd});let c=r("Total assets")||r("Total liabilities and capital");c&&n.push({label:"총 자산",value:c.balance_musd,change:c.change_musd})}let s=[];if(l.liabilities.length>0)s.push(...l.liabilities.map(e=>({label:e.label,value:e.value,change:e.weeklyChange})));else{let e=r("Federal Reserve Notes")||r("F.R. Notes");e&&s.push({label:"연방준비권",value:e.balance_musd,change:e.change_musd});let a=r("Reverse repurchase agreements");a&&s.push({label:"역레포",value:a.balance_musd,change:a.change_musd});let t=r("Deposits")||r("Other liabilities and capital");t&&s.push({label:"예금",value:t.balance_musd,change:t.change_musd});let l=r("Reserve balances with Federal Reserve Banks");l&&s.push({label:"지급준비금",value:l.balance_musd,change:l.change_musd});let n=r("U.S. Treasury, General Account");n&&s.push({label:"TGA",value:n.balance_musd,change:n.change_musd});let o=r("Total liabilities");o&&s.push({label:"총 부채",value:o.balance_musd,change:o.change_musd})}let o=n.find(e=>"총 자산"===e.label)?.value||0,c=s.find(e=>"총 부채"===e.label)?.value||0;return{assetsRows:n,liabilitiesRows:s,totals:{assets:o,liabilities:c}}}(e,c),C=function(e,a){let t=function(e){let a=[];for(let t of["Boston","New York","Philadelphia","Cleveland","Richmond","Atlanta","Chicago","St. Louis","Minneapolis","Kansas City","Dallas","San Francisco"]){let r=e.toLowerCase().indexOf(t.toLowerCase());if(-1===r)continue;let l=e.substring(r,r+1e3),n={},s={};for(let e of["Gold Certificates","SDR Certificates","Securities Held","Treasury Securities","MBS","Repurchase Agreements","Loans"]){let a=g(l,[e]);a&&(n[e]=a.value)}for(let e of["F.R. Notes Outstanding","Reverse Repurchase","Deposits","Capital Paid In","Surplus"]){let a=g(l,[e]);a&&(s[e]=a.value)}let o=Object.values(n).reduce((e,a)=>e+a,0);a.push({bank:t,assets:n,liabilities:s,totalAssets:o})}return a}(a),r=["보스턴","뉴욕","필라델피아","클리블랜드","리치몬드","애틀랜타","시카고","세인트루이스","미니애폴리스","캔자스시티","댈러스","샌프란시스코"],l=["Boston","New York","Philadelphia","Cleveland","Richmond","Atlanta","Chicago","St. Louis","Minneapolis","Kansas City","Dallas","San Francisco"],n=[];for(let e=0;e<t.length;e++){let a=t[e],s=l.findIndex(e=>e===a.bank);if(s>=0){let e={...a.assets,...a.liabilities};n.push({label:r[s],values:e,total:a.totalAssets})}}return{columns:r,rows:n}}(0,c),k=function(e,a){let t=function(e){let a=[],t=e.toLowerCase().indexOf("collateral");if(-1===t)return a;let r=e.substring(t,t+5e3);for(let e of["Boston","New York","Philadelphia","Cleveland","Richmond","Atlanta","Chicago","St. Louis","Minneapolis","Kansas City","Dallas","San Francisco"]){let t=r.toLowerCase().indexOf(e.toLowerCase());if(-1===t)continue;let l=h(r.substring(t,t+500));l.length>=3&&a.push({bank:e,issueAmount:l[0]||0,collateral:l[1]||0,goldCertificate:l[2]||0})}return a}(a),r=["보스턴","뉴욕","필라델피아","클리블랜드","리치몬드","애틀랜타","시카고","세인트루이스","미니애폴리스","캔자스시티","댈러스","샌프란시스코"],l=["Boston","New York","Philadelphia","Cleveland","Richmond","Atlanta","Chicago","St. Louis","Minneapolis","Kansas City","Dallas","San Francisco"],n=[];for(let e of t){let a=l.findIndex(a=>a===e.bank);a>=0&&(n.push({label:`${r[a]} - 발행액`,value:e.issueAmount,change:0}),n.push({label:`${r[a]} - 담보`,value:e.collateral,change:0}),n.push({label:`${r[a]} - 금 증서`,value:e.goldCertificate,change:0}))}return{rows:n}}(0,c),T=w(e.releaseDateText,a),_=w(e.asOfWeekEndedText,T);return console.log("[convertH41ToH4Report] Date conversion:",{releaseDateText:e.releaseDateText,asOfWeekEndedText:e.asOfWeekEndedText,actualReleaseDate:a,reportDate:T,weekEnded:_}),{ok:!0,meta:{reportDate:T,weekEnded:_,sourceUrl:e.sourceUrl,pdfUrl:t,parsedAt:new Date().toISOString()},overview:s,factors:n,summary:o,maturity:u,loansAndLending:y,consolidatedStatement:m,regionalFed:C,frNotes:k}}async function p(e,a,t,r,l){let n=e.cards,s=e=>n.find(a=>a.fedLabel===e),o=s("Total assets")||s("Total Assets")||s("Total liabilities and capital")||s("Total Liabilities and Capital");if(!o||0===o.balance_musd){let e=s("Reserve Bank credit");e&&e.balance_musd>0&&(o=e)}if((!o||0===o.balance_musd)&&e.rawText){let a=e.rawText.match(/Total\s+(?:assets|Assets|liabilities\s+and\s+capital)\s+([\d,]+)/i);if(a){let e=parseFloat(a[1].replace(/,/g,""));e>0&&(o={fedLabel:"Total assets",balance_musd:e,change_musd:0})}}let c=o?.balance_musd||0,i=o?.change_musd||0;console.log("[convertOverview] Total Assets search:",{found:!!o,value:c,change:i,fedLabel:o?.fedLabel,allCardLabels:n.map(e=>e.fedLabel).slice(0,10)});let d=s("Securities held outright"),h=d?.balance_musd||0,g=d?.change_musd||0,b=s("Reserve balances with Federal Reserve Banks"),f=b?.balance_musd||0,y=b?.change_musd||0,p=s("U.S. Treasury, General Account"),v=p?.balance_musd||0,m=p?.change_musd||0,w=s("Reverse repurchase agreements"),C=w?.balance_musd||0,k=w?.change_musd||0,T=s("Currency in circulation"),_=T?.balance_musd||0,L=T?.change_musd||0,R=s("U.S. Treasury securities"),P=s("Mortgage-backed securities"),D=R?.balance_musd||0,S=P?.balance_musd||0,x=h-D-S,F=t.find(e=>{let t=new Date(e.date),r=(new Date(a).getTime()-t.getTime())/864e5;return r>0&&r<=14}),E=i,A=g,O=y,$=m,q=k,B=L;if(F){let e=F.cards.find(e=>e.fedLabel===(o?.fedLabel||"Total assets"));e&&(E=c-e.balance_musd);let a=F.cards.find(e=>"Securities held outright"===e.fedLabel);a&&(A=h-a.balance_musd);let t=F.cards.find(e=>"Reserve balances with Federal Reserve Banks"===e.fedLabel);t&&(O=f-t.balance_musd);let r=F.cards.find(e=>"U.S. Treasury, General Account"===e.fedLabel);r&&($=v-r.balance_musd);let l=F.cards.find(e=>"Reverse repurchase agreements"===e.fedLabel);l&&(q=C-l.balance_musd);let n=F.cards.find(e=>"Currency in circulation"===e.fedLabel);n&&(B=_-n.balance_musd)}let H={change:0,changePercent:0},Y={change:0,changePercent:0},N={change:0,changePercent:0},M={change:0,changePercent:0},U={change:0,changePercent:0},G={change:0,changePercent:0};if(l){let e=l.supplying.find(e=>"RBC"===e.labelEn||e.labelEn.toLowerCase().includes("reserve bank credit")||"RBC"===e.key);e&&(H={change:e.yearlyChange,changePercent:e.yearlyChangePercent});let a=l.supplying.find(e=>"SECURITIES_HELD"===e.labelEn||e.labelEn.toLowerCase().includes("securities held outright")||"SECURITIES_HELD"===e.key);a&&(Y={change:a.yearlyChange,changePercent:a.yearlyChangePercent}),N={change:l.totals.netYearlyChange,changePercent:l.totals.net?l.totals.netYearlyChange/l.totals.net*100:0};let t=l.absorbing.find(e=>"TGA"===e.labelEn||"TGA"===e.key||e.labelEn.toLowerCase().includes("treasury")&&e.labelEn.toLowerCase().includes("general account"));t&&(M={change:t.yearlyChange,changePercent:t.yearlyChangePercent});let r=l.absorbing.find(e=>"RRP"===e.labelEn||"RRP"===e.key||e.labelEn.toLowerCase().includes("reverse repurchase"));r&&(U={change:r.yearlyChange,changePercent:r.yearlyChangePercent});let n=l.absorbing.find(e=>"CURRENCY"===e.labelEn||"CURRENCY"===e.key||e.labelEn.toLowerCase().includes("currency in circulation"));n&&(G={change:n.yearlyChange,changePercent:n.yearlyChangePercent}),console.log("[convertOverview] Using yearly data from factorsData:",{totalAssets:H,securitiesHeld:Y,reserves:N,tga:M,rrp:U,currency:G})}else console.warn("[convertOverview] factorsData not available, using calculateYearlyChange"),H=u(c,a,t,o?.fedLabel||"Total assets"),Y=u(h,a,t,"Securities held outright"),N=u(f,a,t,"Reserve balances with Federal Reserve Banks"),M=u(v,a,t,"U.S. Treasury, General Account"),U=u(C,a,t,"Reverse repurchase agreements"),G=u(_,a,t,"Currency in circulation");return console.log("[convertOverview] Final yearly changes:",{totalAssets:{value:c,yearly:H},securitiesHeld:{value:h,yearly:Y},reserves:{value:f,yearly:N},tga:{value:v,yearly:M},rrp:{value:C,yearly:U},currency:{value:_,yearly:G},usedFactorsData:!!l}),{totalAssets:{value:c,weeklyChange:E,weeklyChangePercent:c?E/c*100:0,yearlyChange:H.change,yearlyChangePercent:H.changePercent},securitiesHeld:{value:h,weeklyChange:A,weeklyChangePercent:h?A/h*100:0,yearlyChange:Y.change,yearlyChangePercent:Y.changePercent},reserves:{value:f,weeklyChange:O,weeklyChangePercent:f?O/f*100:0,yearlyChange:N.change,yearlyChangePercent:N.changePercent},tga:{value:v,weeklyChange:$,weeklyChangePercent:v?$/v*100:0,yearlyChange:M.change,yearlyChangePercent:M.changePercent},rrp:{value:C,weeklyChange:q,weeklyChangePercent:C?q/C*100:0,yearlyChange:U.change,yearlyChangePercent:U.changePercent},currency:{value:_,weeklyChange:B,weeklyChangePercent:_?B/_*100:0,yearlyChange:G.change,yearlyChangePercent:G.changePercent},assetComposition:{treasury:{value:D,percent:h?D/h*100:0},mbs:{value:S,percent:h?S/h*100:0},other:{value:x,percent:h?x/h*100:0}}}}async function v(e,a,r){let{parseFactorsTable1:l}=await t.e(302).then(t.bind(t,302));if(!e.rawText)return console.warn("[convertFactors] rawText not available, falling back to card-based parsing"),m(e,a,r);try{let a=await l(e.rawText,e.sourceUrl),t=a.supplying.map(e=>({label:e.labelKo,labelEn:e.key,value:e.value,change:e.wow,changePercent:e.value?e.wow/e.value*100:0,yearlyChange:e.yoy,yearlyChangePercent:e.value?e.yoy/e.value*100:0})),r=a.absorbing.map(e=>({label:"Other liabilities and capital"===e.key?"Deposits":e.labelKo,labelEn:"Other liabilities and capital"===e.key?"Deposits":e.key,value:e.value,change:e.wow,changePercent:e.value?e.wow/e.value*100:0,yearlyChange:e.yoy,yearlyChangePercent:e.value?e.yoy/e.value*100:0})),n=a.totals.reserveBalances.value;return a.integrity.ok||console.warn("[convertFactors] Reserve balances integrity check failed:",{calculated:a.integrity.calcReserveBalances,fromSource:n,delta:a.integrity.delta}),{supplying:t,absorbing:r,totals:{supplying:a.totals.totalSupplying.value,supplyingWeeklyChange:a.totals.totalSupplying.wow,supplyingYearlyChange:a.totals.totalSupplying.yoy,absorbing:a.totals.totalAbsorbingExReserves.value,absorbingWeeklyChange:a.totals.totalAbsorbingExReserves.wow,absorbingYearlyChange:a.totals.totalAbsorbingExReserves.yoy,net:n,netWeeklyChange:a.totals.reserveBalances.wow,netYearlyChange:a.totals.reserveBalances.yoy}}}catch(t){return console.error("[convertFactors] Failed to parse Table 1 directly, falling back to legacy method:",t),m(e,a,r)}}async function m(e,a,t){let r=e.cards,l=t.find(e=>{let t=new Date(e.date),r=(new Date(a).getTime()-t.getTime())/864e5;return r>0&&r<=14}),n=[],s=[];for(let e of["Reserve Bank credit","Securities held outright","U.S. Treasury securities","Bills","Notes and bonds","TIPS","Mortgage-backed securities","Repurchase agreements","Loans","Bank Term Funding Program","BTFP","Central bank liquidity swaps","Gold","SDR"]){let s=r.find(a=>{let t=a.fedLabel.toLowerCase(),r=e.toLowerCase();return t.includes(r)||r.includes(t)});if(s){let e=s.change_musd;if(l){let a=l.cards.find(e=>e.fedLabel===s.fedLabel);a&&(e=s.balance_musd-a.balance_musd)}let r=u(s.balance_musd,a,t,s.fedLabel);n.push({label:i(s.fedLabel),labelEn:s.fedLabel,value:s.balance_musd,change:e,changePercent:s.balance_musd?e/s.balance_musd*100:0,yearlyChange:r.change,yearlyChangePercent:r.changePercent})}}for(let e of["Reverse repurchase agreements","Currency in circulation","U.S. Treasury, General Account","Deposits with F.R. Banks, other than reserve balances","Other liabilities and capital"]){let n=r.find(a=>{let t=a.fedLabel.toLowerCase(),r=e.toLowerCase();return t.includes(r)||r.includes(t)});if(n){let e=n.change_musd;if(l){let a=l.cards.find(e=>e.fedLabel===n.fedLabel);a&&(e=n.balance_musd-a.balance_musd)}let r=u(n.balance_musd,a,t,n.fedLabel),o="Other liabilities and capital"===n.fedLabel?"Deposits":i(n.fedLabel);s.push({label:o,labelEn:"Other liabilities and capital"===n.fedLabel?"Deposits":n.fedLabel,value:n.balance_musd,change:e,changePercent:n.balance_musd?e/n.balance_musd*100:0,yearlyChange:r.change,yearlyChangePercent:r.changePercent})}}let o=n.reduce((e,a)=>e+a.value,0),c=s.reduce((e,a)=>e+a.value,0),d=o-c,h=0,g=0,b=0;if(l){let e=n.reduce((e,a)=>{let t=l.cards.find(e=>e.fedLabel===a.labelEn);return e+(t?.balance_musd||0)},0),a=s.reduce((e,a)=>{let t=l.cards.find(e=>e.fedLabel===a.labelEn);return e+(t?.balance_musd||0)},0);h=o-e,g=c-a,b=d-(e-a)}else b=(h=n.reduce((e,a)=>e+a.change,0))-(g=s.reduce((e,a)=>e+a.change,0));let f=t.find(e=>{let t=new Date(e.date),r=(new Date(a).getTime()-t.getTime())/864e5;return r>=350&&r<=378}),y=0,p=0,v=0;if(f){let e=n.reduce((e,a)=>{let t=f.cards.find(e=>e.fedLabel===a.labelEn);return e+(t?.balance_musd||0)},0),a=s.reduce((e,a)=>{let t=f.cards.find(e=>e.fedLabel===a.labelEn);return e+(t?.balance_musd||0)},0);y=o-e,p=c-a,v=d-(e-a),console.log("[convertFactors] Yearly totals calculation:",{current:{supplying:o,absorbing:c,net:d},yearAgo:{supplying:e,absorbing:a,net:e-a},changes:{supplying:y,absorbing:p,net:v},yearAgoDate:f.date})}else console.warn("[convertFactors] No year ago data found for totals calculation");let m=o?y/o*100:0,w=c?p/c*100:0,C=d?v/d*100:0;return console.log("[convertFactors] Totals calculation:",{supplying:{total:o,weeklyChange:h,yearlyChange:y,yearlyPercent:m},absorbing:{total:c,weeklyChange:g,yearlyChange:p,yearlyPercent:w},net:{total:d,weeklyChange:b,yearlyChange:v,yearlyPercent:C},hasYearAgoData:!!f,hasPreviousWeekData:!!l}),{supplying:n,absorbing:s,totals:{supplying:o,supplyingWeeklyChange:h,supplyingYearlyChange:y,absorbing:c,absorbingWeeklyChange:g,absorbingYearlyChange:p,net:d,netWeeklyChange:b,netYearlyChange:v}}}function w(e,a){try{if(!e||"(unknown)"===e||""===e.trim()){if(a)return console.warn("[formatDateToISO] Using fallback date:",a),a;return e}if(e.includes(",")&&e.match(/[A-Z][a-z]+\s+\d{1,2},\s+\d{4}/)){let a=new Date(e);if(!isNaN(a.getTime())){let t=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0"),n=`${t}-${r}-${l}`;return console.log("[formatDateToISO] Parsed date:",e,"->",n),n}}if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;let t=new Date(e);if(!isNaN(t.getTime())){let a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0"),n=`${a}-${r}-${l}`;return console.log("[formatDateToISO] Parsed date (general):",e,"->",n),n}if(a)return console.warn("[formatDateToISO] Failed to parse date, using fallback:",e,"->",a),a;return console.warn("[formatDateToISO] Failed to parse date (no fallback):",e),e}catch(t){if(console.error("[formatDateToISO] Error parsing date:",e,t),a)return a;return e}}let C="force-dynamic",k=0,T="nodejs";async function _(e){let a=`req-${Date.now()}-${Math.random().toString(36).substring(7)}`;try{let t,r;let l=new URL(e.url),n=l.searchParams.get("date")??"",s="1"===l.searchParams.get("debug");if(!n)return o.NextResponse.json({ok:!1,error:"date parameter is required (YYYY-MM-DD)"},{status:400});if(!/^\d{4}-\d{2}-\d{2}$/.test(n))return o.NextResponse.json({ok:!1,error:"Invalid date format. Use YYYY-MM-DD"},{status:400});let c=await (0,b.AU)();console.log(`[${a}] Available dates count: ${c.length}`);let i=((e,t)=>{if(0===t.length)return e;let r=new Date(e),l=null,n=1/0;if(t.includes(e))return console.log(`[${a}] Exact match found: ${e}`),e;for(let e of t){let a=new Date(e),t=Math.abs(a.getTime()-r.getTime());t<n&&(n=t,l=e)}if(l){let t=Math.round(n/864e5);return console.log(`[${a}] Closest release date found: ${l} (${t} days from ${e})`),l}return e})(n,c),u=i.replace(/-/g,""),d=`https://www.federalreserve.gov/releases/h41/${u}/h41.pdf`;try{if(console.log(`[${a}] Fetching H.4.1 report for date: ${n} -> actual release date: ${i}`),!(t=await (0,b.v9)(i,c))||!t.cards||!Array.isArray(t.cards))throw Error("Invalid H41Report format: missing cards array");if(!t.cards.some(e=>0!==e.balance_musd||0!==e.change_musd))return console.error(`[${a}] All card values are zero`),o.NextResponse.json({ok:!1,error:"Parsed data appears invalid (all zeros). The H.4.1 page structure may have changed.",...s&&{requestId:a,date:n,cardCount:t.cards.length}},{status:500});s&&console.log(`[${a}] H41 Report fetched:`,{releaseDate:t.releaseDateText,weekEnded:t.asOfWeekEndedText,cardCount:t.cards.length,coreCardCount:t.coreCards.length,sampleCard:t.coreCards[0]})}catch(a){let e=a instanceof Error?a.message:String(a);return console.error("H41 fetch error:",{date:n,error:e,stack:a instanceof Error?a.stack:void 0}),o.NextResponse.json({ok:!1,error:`Failed to fetch H.4.1 report: ${e}`,...s&&{date:n,pdfUrl:d,errorDetails:e}},{status:500})}try{if(!(r=await y(t,i,d)).meta)throw Error("convertH41ToH4Report returned data without meta field");console.log(`[${a}] H4 Report converted:`,{overview:r.overview?{totalAssets:{value:r.overview.totalAssets.value,weeklyChange:r.overview.totalAssets.weeklyChange,yearlyChange:r.overview.totalAssets.yearlyChange},securitiesHeld:{value:r.overview.securitiesHeld.value,weeklyChange:r.overview.securitiesHeld.weeklyChange,yearlyChange:r.overview.securitiesHeld.yearlyChange},reserves:{value:r.overview.reserves.value,weeklyChange:r.overview.reserves.weeklyChange,yearlyChange:r.overview.reserves.yearlyChange}}:null,weekEnded:r.meta.weekEnded,factors:r.factors?{supplyingCount:r.factors.supplying.length,absorbingCount:r.factors.absorbing.length}:null}),s&&console.log(`[${a}] Full H4 Report:`,JSON.stringify(r,null,2))}catch(e){return console.error("Conversion error:",e),o.NextResponse.json({ok:!1,error:`Failed to convert H41Report to H4Report: ${e instanceof Error?e.message:String(e)}`,...s&&{rawError:String(e)}},{status:500})}return o.NextResponse.json(r,{headers:{"Cache-Control":"public, s-maxage=21600, stale-while-revalidate=86400"}})}catch(e){return console.error("Error in report route:",e),o.NextResponse.json({ok:!1,error:e instanceof Error?e.message:String(e)},{status:500})}}let L=new l.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/h41/report/route",pathname:"/api/h41/report",filename:"route",bundlePath:"app/api/h41/report/route"},resolvedPagePath:"C:\\Users\\Dick\\FED_h.4.1\\h41-dashboard\\app\\api\\h41\\report\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:R,staticGenerationAsyncStorage:P,serverHooks:D}=L,S="/api/h41/report/route";function x(){return(0,s.patchFetch)({serverHooks:D,staticGenerationAsyncStorage:P})}}};var a=require("../../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[276,972,249,896],()=>t(891));module.exports=r})();