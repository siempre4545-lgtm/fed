"use strict";exports.id=385,exports.ids=[385],exports.modules={385:(e,l,t)=>{t.d(l,{v9:()=>A,AU:()=>L,lm:()=>p});var r=t(917);function a(e){if(!e)return null;let l=e.replace(/\u00a0/g," ").trim();if(!l||!/\d/.test(l))return null;let t=l.match(/^([+-])?\s*([\d,]+(?:\.[\d]+)?)/);if(!t)return null;let r="-"===t[1]?-1:1,a=Number(t[2].replace(/,/g,""));return Number.isFinite(a)?r*a:null}function n(e){return e.replace(/\u00a0/g," ").replace(/[()]/g," ").replace(/\./g," ").replace(/&/g,"and").replace(/,/g," ").replace(/\s+\d+$/g,"").replace(/\d+$/g,"").replace(/\s*\(\d+\)\s*/g," ").replace(/\s+/g," ").toLowerCase().trim()}function s(e,l){let t=n(e);for(let e of l){let l=n(e);if(t===l)return e;let r=l.split(/\s+/).filter(e=>e.length>2);if(r.length>0&&r.every(e=>t.includes(e)))return e}return null}function i(e,l){let t=e("body"),r=t.text();for(let a of l){if(!r.includes(a))continue;let l=null;if(e('h1, h2, h3, h4, h5, h6, p, strong, b, div[class*="title"], div[class*="header"]').each((t,r)=>{if(e(r).text().includes(a))return l=r,!1}),!l){let r=t.find("*");for(let t=0;t<r.length;t++){let n=r[t];e(n).text().includes(a)&&(!l||e(n).children().length<e(l).children().length)&&(l=n)}}if(l){let r=e(l).closest("table");if(0===r.length&&(r=e(l).closest("div, section, article, main")),0===r.length&&(r=e(l).parent()),r.length>0&&r[0]!==t[0])return r;return e(l)}}return null}function o(e,l,t){if(0===l.length)return null;if("table"===l.prop("tagName")?.toLowerCase())return l;let r=l.find("table").first();if(r.length>0)return r;let a=l.nextAll(),n=0;for(let e=0;e<a.length&&n<30;e++){let l=a.eq(e);n++;let t=l.prop("tagName")?.toLowerCase();if(t&&["h1","h2","h3","h4","h5","h6"].includes(t)){let e=l.text().trim();e.length>0&&e.match(/table|factors|statement|condition|maturity|loans/i)}if("table"===t)return l;let r=l.find("table").first();if(r.length>0)return r}let s=l.parent();if(s.length>0){let e=s.find("table").first();if(e.length>0)return e;let l=s.nextAll();for(let e=0;e<l.length&&e<15;e++){let t=l.eq(e),r=t.find("table").first();if(r.length>0)return r;if(t.prop("tagName")?.toLowerCase()==="table")return t}}let i=l.prevAll();n=0;for(let e=0;e<i.length&&n<30;e++){let l=i.eq(e);n++;let t=l.find("table").first();if(t.length>0)return t;if("table"===l.prop("tagName")?.toLowerCase())return l}let o=e("body").find("table"),u=[];u=t&&t.length>0?t.map(e=>e.toLowerCase()):l.text().split(/\s+/).filter(e=>e.length>3).slice(0,5).map(e=>e.toLowerCase());for(let e=0;e<o.length;e++){let l=o.eq(e),t=l.text().toLowerCase();if(u.some(e=>t.includes(e))||t.includes("factors affecting")||t.includes("reserve balances"))return l}return null}function u(e,l,t){let r=l.find("tr");for(let l=0;l<r.length;l++){let a=r[l];if(s(e(a).find("td, th").first().text().trim(),t))return e(a)}return null}function c(e,l,t){let r=l.find("tr").slice(0,5);if(0===r.length)return -1;let a=/\b(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{1,2},\s+\d{4}\b/i,s=/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun)day\b/i,i=Math.max(...Array.from(r).map((l,t)=>{let r=e(l).find("td, th"),a=0;return r.each((l,t)=>{let r=parseInt(e(t).attr("colspan")||"1",10);a+=r}),a})),o=[];for(let e=0;e<i;e++)o[e]=[];for(let l=0;l<r.length;l++){let t=e(r[l]).find("td, th"),a=0;t.each((l,t)=>{let r=e(t).text().trim(),n=parseInt(e(t).attr("colspan")||"1",10);for(let e=0;e<n&&a+e<i;e++)r&&o[a+e].push(r);a+=n})}for(let l of t){let t=n(l),i=l.toLowerCase();for(let l=r.length-1;l>=0;l--){let o=e(r[l]).find("td, th"),u=0;for(let l=0;l<o.length;l++){let r=o[l],c=e(r).text().trim(),d=n(c),h=parseInt(e(r).attr("colspan")||"1",10);if(i.includes("week ended")){let e=c.toLowerCase();if(e.startsWith("week ended")||d.startsWith("week ended")||e.includes("week ended")&&a.test(c))return u}else if(d===t||d.includes(t))return u;if((a.test(c)||s.test(c))&&(i.includes("wednesday")||i.includes("week ended")||i.includes("level")||i.includes("averages"))||i.includes("change from week ended")&&c.toLowerCase().includes("change from week ended")||i.includes("change from year ago")&&c.toLowerCase().includes("change from year ago"))return u;u+=h}}for(let e=0;e<o.length;e++){let l=o[e].join(" ").trim();if(!l)continue;let r=n(l);if(i.includes("week ended")){if((r.startsWith("week ended")||l.toLowerCase().includes("week ended"))&&(o[e].length>0?o[e][o[e].length-1].toLowerCase():"").includes("week ended"))return e}else if(r===t||r.includes(t))return e;if((a.test(l)||s.test(l))&&(i.includes("wednesday")||i.includes("week ended")||i.includes("level")||i.includes("averages")))return e;let u=t.split(/\s+/).filter(e=>e.length>2);if(u.length>0&&u.every(e=>r.includes(e)))return e}}return -1}function d(e,l,t,r){let a;if(0===l.length)return r&&r.push("[pickH41Table] Scope is empty"),null;if(0===(a=l.prop("tagName")?.toLowerCase()==="body"||1===l.length&&l.is("body")?e("table"):l.find("table")).length)return l.prop("tagName")?.toLowerCase()==="table"?l:(r&&r.push("[pickH41Table] No tables found in scope"),null);r&&r.push(`[pickH41Table] Found ${a.length} tables in scope, searching for labels: ${t.join(", ")}`);let s=null,i=0,o=[];for(let e=0;e<a.length;e++){let l=a.eq(e),r=l.text().toLowerCase(),u=l.find("tr").length;if(u<5)continue;let c=0,d=[];for(let e of t){let l=n(e);(r.includes(l)||r.includes(e.toLowerCase()))&&(c++,d.push(e))}o.push({index:e,score:c,matches:d,rowCount:u}),c>=2&&c>i&&(s=l,i=c)}if(r&&null===s){let e=o.sort((e,l)=>l.score-e.score).slice(0,3).map(e=>`Table ${e.index}: score=${e.score}, rows=${e.rowCount}, matches=[${e.matches.join(", ")}]`).join("; ");r.push(`[pickH41Table] No table found with 2+ matches and 5+ rows. Top matches: ${e}`)}else if(r&&s){let e=s.find("tr").length;r.push(`[pickH41Table] Selected table with score ${i}, rows: ${e}`)}return s}function h(e,l){let t={valueCol:-1,weeklyCol:-1,yearlyCol:-1,avgCol:-1};if(0===l.length)return t;let r=l.find("tr").slice(0,5);if(0===r.length)return t;let n=/\b(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s+\d{1,2},\s+\d{4}\b/i,s=Math.max(...Array.from(r).map(l=>{let t=e(l).find("td, th"),r=0;return t.each((l,t)=>{let a=parseInt(e(t).attr("colspan")||"1",10);r+=a}),r})),i=[];for(let e=0;e<s;e++)i[e]=[];for(let l=0;l<r.length;l++){let t=e(r[l]).find("td, th"),a=0;t.each((l,t)=>{let r=e(t).text().trim(),n=parseInt(e(t).attr("colspan")||"1",10);parseInt(e(t).attr("rowspan")||"1",10);for(let e=0;e<n&&a+e<s;e++)r&&i[a+e].push(r);a+=n})}let o=[];for(let e=0;e<i.length;e++){let l=i[e].join(" ").trim();o[e]=l}for(let e=0;e<o.length;e++)if(o[e].toLowerCase().includes("week ended")){t.valueCol=e;break}if(t.valueCol<0){let n=l.find("tr").slice(r.length);for(let l=0;l<Math.min(3,n.length);l++){let r=e(n[l]).find("td, th");for(let l=0;l<r.length;l++)if(null!==a(e(r[l]).text().trim())){t.valueCol=l;break}if(t.valueCol>=0)break}}for(let e=0;e<o.length;e++){let l=o[e].toLowerCase();t.weeklyCol<0&&(l.includes("change from previous week")||l.includes("change from week ended"))&&(t.weeklyCol=e),t.yearlyCol<0&&l.includes("change from year ago")&&(t.yearlyCol=e)}if(t.weeklyCol<0||t.yearlyCol<0){let e=[];for(let l=0;l<o.length;l++)o[l].toLowerCase().includes("change from week ended")&&e.push(l);let l=[];for(let e=0;e<o.length;e++){let t=o[e].match(n);t&&l.push({colIdx:e,dateText:t[0]})}l.length>=1&&t.weeklyCol<0&&(t.weeklyCol=l[0].colIdx),l.length>=2&&t.yearlyCol<0&&(t.yearlyCol=l[1].colIdx)}for(let e=0;e<o.length;e++)if(o[e].toLowerCase().includes("averages of daily figures")){t.avgCol=e;break}return t}class f extends Error{constructor(e,l,t,r){super(l),this.code=e,this.url=t,this.status=r,this.name="FetchH41Error"}}function y(e){let l=e.toLowerCase(),t=l.includes("an official website of the united states government"),r=["h.4.1","factors affecting reserve balances","consolidated statement of condition","reserve bank credit"].filter(e=>l.includes(e));return(!t||!(r.length<2))&&r.length>=2}async function g(e){let l;let t=e.replace(/-/g,""),r=`https://www.federalreserve.gov/releases/h41/${t}/default.htm`,a={redirect:"follow",cache:"no-store",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9",Referer:"https://www.federalreserve.gov/releases/h41/"}};try{l=await fetch(r,a)}catch(e){throw new f("FETCH_BLOCKED_OR_UNEXPECTED_HTML",`Failed to fetch H.4.1 HTML: ${e instanceof Error?e.message:String(e)}`,r)}if(!l.ok)throw new f(`HTTP_ERROR_${l.status}`,`HTTP ${l.status} ${l.statusText}`,r,l.status);let n=await l.text();if(y(n))return{html:n,url:r,fetchedAt:new Date().toISOString()};try{let e={...a,headers:{...a.headers,"Accept-Language":"en-US,en;q=0.8"}};if((l=await fetch(r,e)).ok&&(n=await l.text(),y(n)))return{html:n,url:r,fetchedAt:new Date().toISOString()}}catch(e){}try{let l=await fetch("https://www.federalreserve.gov/releases/h41/",a);if(l.ok){let a=await l.text();if(!RegExp(`/releases/h41/${t}/`,"i").test(a))throw new f("NO_RELEASE_FOR_DATE",`No H.4.1 release found for date ${e}`,r)}}catch(e){if(e instanceof f)throw e}throw new f("FETCH_BLOCKED_OR_UNEXPECTED_HTML","Failed to fetch valid H.4.1 HTML after multiple attempts. The page may be blocked or contain unexpected content.",r)}async function p(e,l){let t=[];try{let n,y;if(l)n=l;else try{let l=await g(e);n=l.html,y=l.url,t.push(`[parseH41HTML] fetchedUrl: ${y}`),t.push("[parseH41HTML] htmlValidationResult: OK")}catch(l){if(l instanceof f)return t.push(`[parseH41HTML] fetchedUrl: ${l.url||"unknown"}`),t.push("[parseH41HTML] htmlValidationResult: FAIL"),t.push(`[parseH41HTML] failCode: ${l.code}`),{ok:!1,date:e,releaseDate:"",weekEnded:"",sections:{overview:w(),factors:m(),summary:k(),maturity:T(),lending:R(),statement:S()},warnings:[`${l.code}: ${l.message}`]};throw l}let p=function(e,l,t,n){let f=r.zD(e),y=function(e){let l=e("body").text().match(/Release\s+Date[:\s]+([A-Z][a-z]{2,}\s+\d{1,2},\s+\d{4})/i);if(l){let e=function(e){if(!e)return null;let l=e.match(/([A-Z][a-z]{2,})\s+(\d{1,2}),\s+(\d{4})/);if(!l)return null;let t={Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sep:"09",Oct:"10",Nov:"11",Dec:"12"}[l[1]];if(!t)return null;let r=String(l[2]).padStart(2,"0"),a=l[3];return`${a}-${t}-${r}`}(l[1]);if(e)return e}return""}(f),g=f("table").length;n&&t.push(`[parseH41HTML] fetchedUrl: ${n}`),t.push(`[parseH41HTML] htmlValidationResult: OK, tables: ${g}`);let p=null,k=i(f,["Factors Affecting Reserve Balances","Table 1","Factors affecting reserve balances"]);if(k&&0!==k.length||(k=f("body")),(p=d(f,k,["Reserve Bank credit","Total factors supplying reserve funds","Currency in circulation","U.S. Treasury, General Account"],t))&&0!==p.length||(t.push("[parseH41HTML] Table 1 not found in section, trying body-wide search"),p=d(f,f("body"),["Reserve Bank credit","Total factors supplying reserve funds","Currency in circulation","U.S. Treasury, General Account"],t)),p&&p.length>0){let e=p.find("tr").length;e<5?(t.push(`[parseH41HTML] Found table has only ${e} rows, too few`),p=null):t.push(`[parseH41HTML] Found shared Table 1 with ${e} rows`)}let C=function(e,l,t){let r=null;if(t&&t.length>0)r=t,l.push("[Overview] Using shared Table 1");else{let t=i(e,["Factors Affecting Reserve Balances","Table 1","Factors affecting reserve balances"]);if(t&&0!==t.length||(l.push("[Overview] Section not found, using body as scope"),t=e("body")),(r=d(e,t,["Reserve Bank credit","Total factors supplying reserve funds","Currency in circulation","U.S. Treasury, General Account"],l))&&0!==r.length||(l.push("[Overview] Table 1 not found in section, trying body-wide search"),r=d(e,e("body"),["Reserve Bank credit","Total factors supplying reserve funds","Currency in circulation","U.S. Treasury, General Account"],l)),(!r||0===r.length)&&(l.push("[Overview] Table 1 not found using pickH41Table, trying findFirstTableNearSection"),!(r=o(e,t,["Factors Affecting Reserve Balances","Table 1"]))||0===r.length))return l.push("[Overview] Table 1 not found using fallback method"),w();let a=r.find("tr").length;if(a<5)return l.push(`[Overview] Selected table has only ${a} rows, too few for data table`),w()}let a=r.find("tr").length,n=[];r.find("tr").slice(0,3).each((l,t)=>{let r=e(t).find("td, th"),a=[];r.slice(0,5).each((l,t)=>{a.push(e(t).text().trim().substring(0,50))}),n.push(a)}),l.push(`[Overview] Selected table - ${a} rows, first 3 rows sample: ${JSON.stringify(n)}`);let{valueCol:s,weeklyCol:u,yearlyCol:f}=h(e,r);if(s>=0&&u>=0&&f>=0)l.push(`[Overview] Column indices found - valueCol: ${s}, weeklyCol: ${u}, yearlyCol: ${f}`);else{let t=Array.from(r.find("tr").slice(0,3)).map((l,t)=>Array.from(e(l).find("td, th")).slice(0,6).map((l,r)=>({row:t,col:r,text:e(l).text().trim().substring(0,60),colspan:e(l).attr("colspan")||"1"})));l.push(`[Overview] Column indices FAILED - valueCol: ${s}, weeklyCol: ${u}, yearlyCol: ${f}`),l.push(`[Overview] Header structure: ${JSON.stringify(t).substring(0,400)}`)}if(s<0||u<0||f<0)return l.push("[Overview] Cannot proceed - missing column indices"),w();let y=v(r,e,["Total factors supplying reserve funds","Total factors supplying","Total supplying"],s,l),g=v(r,e,["Securities held outright","Securities held","Securities"],s,l),p=v(r,e,["Reserve balances with Federal Reserve Banks","Reserve balances","Reserves"],s,l),b=v(r,e,["U.S. Treasury, General Account","Treasury General Account","Treasury, General Account","TGA"],s,l),m=v(r,e,["Reverse repurchase agreements","Reverse repos","Reverse repurchase"],s,l),k=v(r,e,["Currency in circulation","Currency","Federal Reserve notes"],s,l),T=v(r,e,["Total factors supplying reserve funds","Total factors supplying"],u,l),C=v(r,e,["Total factors supplying reserve funds","Total factors supplying"],f,l),R=v(r,e,["Securities held outright","Securities held"],u,l),S=v(r,e,["Securities held outright","Securities held"],f,l),A=v(r,e,["Reserve balances with Federal Reserve Banks","Reserve balances","Reserves"],u,l),L=v(r,e,["Reserve balances with Federal Reserve Banks","Reserve balances","Reserves"],f,l),F=v(r,e,["U.S. Treasury, General Account","Treasury General Account","TGA"],u,l),x=v(r,e,["U.S. Treasury, General Account","Treasury General Account","TGA"],f,l),B=v(r,e,["Reverse repurchase agreements","Reverse repos"],u,l),$=v(r,e,["Reverse repurchase agreements","Reverse repos"],f,l),M=v(r,e,["Currency in circulation","Currency"],u,l),W=v(r,e,["Currency in circulation","Currency"],f,l),O=i(e,["Consolidated Statement of Condition","Table 5","Consolidated Statement"]),H=null,D=null,U=null,K=null;if(O&&O.length>0){let t=o(e,O,["Consolidated Statement","Assets","Liabilities","Table 5"]);if(t&&t.length>0){let r=c(e,t,["Wednesday","Week ended","Assets","Level","Averages of daily figures"]);H=v(t,e,["Total assets","Total"],r,l),D=v(t,e,["U.S. Treasury securities","U.S. Treasury","Treasury securities","Treasury"],r,l),U=v(t,e,["Mortgage-backed securities","Mortgage backed securities","MBS"],r,l),null!==H&&null!==D&&null!==U?null===(K=v(t,e,["Other assets","Other","Other assets (including unamortized premiums and discounts)","Other Federal Reserve assets"],r,l))&&(K=H-((D||0)+(U||0)))<0&&(K=null):K=v(t,e,["Other assets","Other","Other assets (including unamortized premiums and discounts)","Other Federal Reserve assets"],r,l)}}return{totalAssets:y,securities:g,reserveBalances:p,tga:b,reverseRepos:m,currency:k,totalAssetsWeekly:T,totalAssetsYearly:C,securitiesWeekly:R,securitiesYearly:S,reserveBalancesWeekly:A,reserveBalancesYearly:L,tgaWeekly:F,tgaYearly:x,reverseReposWeekly:B,reverseReposYearly:$,currencyWeekly:M,currencyYearly:W,totalAssetsForComposition:H,treasurySecurities:D,mortgageBackedSecurities:U,otherAssets:K}}(f,t,p),R=function(e,l,t){let r=null;if(t&&t.length>0)r=t,l.push("[Factors] Using shared Table 1");else{let t=i(e,["Factors Affecting Reserve Balances","Table 1","Factors affecting reserve balances"]);if(t&&0!==t.length||(l.push("[Factors] Section not found, using body as scope"),t=e("body")),(r=d(e,t,["Reserve Bank credit","Total factors supplying reserve funds","Currency in circulation","U.S. Treasury, General Account"],l))&&0!==r.length||(l.push("[Factors] Table 1 not found in section, trying body-wide search"),r=d(e,e("body"),["Reserve Bank credit","Total factors supplying reserve funds","Currency in circulation","U.S. Treasury, General Account"],l)),(!r||0===r.length)&&(l.push("[Factors] Table 1 not found using pickH41Table, trying findFirstTableNearSection"),!(r=o(e,t,["Factors Affecting Reserve Balances","Table 1"]))||0===r.length))return l.push("[Factors] Table 1 not found using fallback method"),m();let a=r.find("tr").length;if(a<5)return l.push(`[Factors] Selected table has only ${a} rows, too few for data table`),m()}let n=r.find("tr").length;l.push(`[Factors] Selected table - ${n} rows`);let{valueCol:f,weeklyCol:y,yearlyCol:g}=h(e,r);if(f>=0&&y>=0&&g>=0?l.push(`[Factors] Column indices found - valueCol: ${f}, weeklyCol: ${y}, yearlyCol: ${g}`):l.push(`[Factors] Column indices FAILED - valueCol: ${f}, weeklyCol: ${y}, yearlyCol: ${g}`),f<0||y<0||g<0)return l.push("[Factors] Cannot proceed - missing column indices"),m();let p=[{label:"Reserve Bank credit",labelKo:"연준 신용",value:null,weekly:null,yearly:null},{label:"Securities held outright",labelKo:"보유 증권",value:null,weekly:null,yearly:null},{label:"U.S. Treasury securities",labelKo:"미 국채",value:null,weekly:null,yearly:null},{label:"Bills",labelKo:"단기채",value:null,weekly:null,yearly:null},{label:"Notes and bonds, nominal",labelKo:"중장기채",value:null,weekly:null,yearly:null},{label:"Notes and bonds, inflation-indexed",labelKo:"물가연동채",value:null,weekly:null,yearly:null},{label:"Mortgage-backed securities",labelKo:"주택저당증권",value:null,weekly:null,yearly:null},{label:"Repurchase agreements",labelKo:"레포",value:null,weekly:null,yearly:null},{label:"Loans",labelKo:"대출",value:null,weekly:null,yearly:null},{label:"Bank Term Funding Program",labelKo:"은행기간대출",value:null,weekly:null,yearly:null},{label:"Central bank liquidity swaps",labelKo:"통화스왑",value:null,weekly:null,yearly:null},{label:"Gold stock",labelKo:"금",value:null,weekly:null,yearly:null},{label:"Special drawing rights certificate account",labelKo:"SDR 증서",value:null,weekly:null,yearly:null}],b={"Reserve Bank credit":["Reserve Bank credit","Reserve bank credit"],"Securities held outright":["Securities held outright","Securities held"],"U.S. Treasury securities":["U.S. Treasury securities","U.S. Treasury","Treasury securities"],Bills:["Bills","Treasury bills"],"Notes and bonds, nominal":["Notes and bonds, nominal","Notes and bonds nominal","Nominal notes and bonds"],"Notes and bonds, inflation-indexed":["Notes and bonds, inflation-indexed","Notes and bonds inflation-indexed","Inflation-indexed notes and bonds","TIPS"],"Mortgage-backed securities":["Mortgage-backed securities","Mortgage backed securities","MBS"],"Repurchase agreements":["Repurchase agreements","Repos"],Loans:["Loans","Total loans"],"Bank Term Funding Program":["Bank Term Funding Program","BTFP","Bank term funding program"],"Central bank liquidity swaps":["Central bank liquidity swaps","Central bank swaps","Liquidity swaps"],"Gold stock":["Gold stock","Gold certificate account","Gold"],"Special drawing rights certificate account":["Special drawing rights certificate account","SDR certificate account","SDR"]},w=p.find(e=>"Central bank liquidity swaps"===e.label);if(w&&(w.value=v(r,e,["Central bank liquidity swaps"],f,l),w.weekly=v(r,e,["Central bank liquidity swaps"],y,l),w.yearly=v(r,e,["Central bank liquidity swaps"],g,l),null===w.value)){let t=i(e,["Statement of Condition of Each Federal Reserve Bank","Table 6"]);if(t&&t.length>0){let r=o(e,t,["Statement of Condition","Central bank liquidity swaps"]);if(r&&r.length>0){let t=c(e,r,["Total","Wednesday","Level"]),a=c(e,r,["Change since","Change from"]),n=c(e,r,["Change from year ago"]);w.value=v(r,e,["Central bank liquidity swaps"],t,l),w.weekly=v(r,e,["Central bank liquidity swaps"],a,l),w.yearly=v(r,e,["Central bank liquidity swaps"],n,l)}}}let k=p.find(e=>"Special drawing rights certificate account"===e.label);if(k&&(k.value=v(r,e,["Special drawing rights certificate account"],f,l),k.weekly=v(r,e,["Special drawing rights certificate account"],y,l),k.yearly=v(r,e,["Special drawing rights certificate account"],g,l),null===k.value)){let t=i(e,["Consolidated Statement of Condition","Table 5"]);if(t&&t.length>0){let r=o(e,t,["Consolidated Statement","Assets"]);if(r&&r.length>0){let t=c(e,r,["Assets","Wednesday","Level"]),a=c(e,r,["Change since","Change from"]),n=c(e,r,["Change from year ago"]);k.value=v(r,e,["Special drawing rights certificate account","SDR certificate account","SDR"],t,l),k.weekly=v(r,e,["Special drawing rights certificate account","SDR certificate account","SDR"],a,l),k.yearly=v(r,e,["Special drawing rights certificate account","SDR certificate account","SDR"],n,l)}}}for(let t of p){let n=b[t.label]||[t.label];if(t.value=v(r,e,n,f,l),t.weekly=v(r,e,n,y,l),t.yearly=v(r,e,n,g,l),("Bills"===t.label||"Notes and bonds, nominal"===t.label||"Notes and bonds, inflation-indexed"===t.label)&&null===t.value){let l=u(e,r,["U.S. Treasury securities","Treasury securities"]);if(l&&l.length>0){let l=r.find("tr"),i=!1;for(let r=0;r<l.length;r++){let o=e(l[r]),u=o.find("td, th").first().text().trim();if(s(u,["U.S. Treasury securities","Treasury securities"])){i=!0;continue}if(i){if(u.match(/^\s+/)||u.match(/^[•·\-\s]/)){if(s(u,n)){let l=o.find("td, th");t.value=f>=0&&l.length>f?a(e(l[f]).text()):null,t.weekly=y>=0&&l.length>y?a(e(l[y]).text()):null,t.yearly=g>=0&&l.length>g?a(e(l[g]).text()):null;break}}else break}}}}}let T=[{label:"Currency in circulation",labelKo:"유통 통화",value:null,weekly:null,yearly:null},{label:"Reverse repurchase agreements",labelKo:"역레포",value:null,weekly:null,yearly:null},{label:"Deposits with F.R. Banks, other than reserve balances",labelKo:"연준 예치금",value:null,weekly:null,yearly:null},{label:"U.S. Treasury, General Account",labelKo:"재무부 일반계정",value:null,weekly:null,yearly:null}],C={"Currency in circulation":["Currency in circulation","Currency","Federal Reserve notes"],"Reverse repurchase agreements":["Reverse repurchase agreements","Reverse repos","Reverse repurchase"],"Deposits with F.R. Banks, other than reserve balances":["Deposits with F.R. Banks, other than reserve balances","Deposits with F.R. Banks","Deposits other than reserve balances","Other deposits"],"U.S. Treasury, General Account":["U.S. Treasury, General Account","Treasury General Account","Treasury, General Account","TGA","U.S. Treasury General Account"]};for(let t of T){let a=C[t.label]||[t.label];t.value=v(r,e,a,f,l),t.weekly=v(r,e,a,y,l),t.yearly=v(r,e,a,g,l)}let R={value:v(r,e,["Total factors supplying reserve funds","Total factors supplying","Total supplying","Total factors"],f,l),weekly:v(r,e,["Total factors supplying reserve funds","Total factors supplying","Total supplying"],y,l),yearly:v(r,e,["Total factors supplying reserve funds","Total factors supplying","Total supplying"],g,l)},S={value:v(r,e,["Total factors, other than reserve balances, absorbing reserve funds","Total factors absorbing reserve funds","Total factors absorbing","Total absorbing","Total factors other than reserve balances"],f,l),weekly:v(r,e,["Total factors, other than reserve balances, absorbing reserve funds","Total factors absorbing reserve funds","Total factors absorbing"],y,l),yearly:v(r,e,["Total factors, other than reserve balances, absorbing reserve funds","Total factors absorbing reserve funds","Total factors absorbing"],g,l)},A={value:v(r,e,["Reserve balances with Federal Reserve Banks","Reserve balances","Reserves","Reserve balances at Federal Reserve Banks"],f,l),weekly:v(r,e,["Reserve balances with Federal Reserve Banks","Reserve balances","Reserves"],y,l),yearly:v(r,e,["Reserve balances with Federal Reserve Banks","Reserve balances","Reserves"],g,l)};return 13!==p.length&&l.push(`Supplying items count mismatch: expected 13, got ${p.length}`),4!==T.length&&l.push(`Absorbing items count mismatch: expected 4, got ${T.length}`),{supplying:p,absorbing:T,totals:{totalSupplying:R,totalAbsorbing:S,reserveBalances:A}}}(f,t,p),A={supplyingTop:[R.supplying.find(e=>"보유 증권"===e.labelKo)||{label:"",labelKo:"보유 증권",value:null,weekly:null,yearly:null},R.supplying.find(e=>"레포"===e.labelKo)||{label:"",labelKo:"레포",value:null,weekly:null,yearly:null},R.supplying.find(e=>"대출"===e.labelKo)||{label:"",labelKo:"대출",value:null,weekly:null,yearly:null},R.supplying.find(e=>"통화스왑"===e.labelKo)||{label:"",labelKo:"통화스왑",value:null,weekly:null,yearly:null}].filter(e=>null!==e.value),absorbingTop:[R.absorbing.find(e=>"유통 통화"===e.labelKo)||{label:"",labelKo:"유통 통화",value:null,weekly:null,yearly:null},R.absorbing.find(e=>"역레포"===e.labelKo)||{label:"",labelKo:"역레포",value:null,weekly:null,yearly:null},R.absorbing.find(e=>"재무부 일반계정"===e.labelKo)||{label:"",labelKo:"재무부 일반계정",value:null,weekly:null,yearly:null},{label:"Reserve balances with Federal Reserve Banks",labelKo:"지급준비금",...R.totals.reserveBalances}].filter(e=>null!==e.value)},L=function(e,l){let t=i(e,["Maturity Distribution of Securities","Table 2"]);if(!t||0===t.length)return l.push("Maturity section not found"),T();let r=o(e,t,["Maturity","Treasury","Mortgage"]);if(!r||0===r.length)return T();let a=c(e,r,["Within 15 days","within 15 days","15 days","15 days or less","0-15 days"]),n=c(e,r,["16 days to 90 days","16-90 days","16 to 90","16-90","16 days to 90"]),s=c(e,r,["91 days to 1 year","91일-1년","91-365","91 days to 365 days","91-365 days"]),d=c(e,r,["Over 1 year to 5 years","1-5 years","1 to 5","1-5","Over 1 year to 5"]),h=c(e,r,["Over 5 years to 10 years","5-10 years","5 to 10","5-10","Over 5 years to 10"]),f=c(e,r,["Over 10 years","10 years and over","10+","Over 10","10 years or more"]),y=c(e,r,["All","Total","All maturities","Total all maturities"]),g=u(e,r,["U.S. Treasury securities","Treasury securities","U.S. Treasury","Treasury","Treasury debt"]),p=u(e,r,["Mortgage-backed securities","Mortgage backed securities","MBS","Mortgage-backed","Mortgage securities"]);return{treasury:b(e,g,r,a,n,s,d,h,f,y,l),mbs:b(e,p,r,a,n,s,d,h,f,y,l)}}(f,t),F=function(e,l){let t=i(e,["Factors Affecting Reserve Balances"]),r=i(e,["Memorandum Items","1A"]),a=null,n=null,s=null,u=null,d=null;if(t&&t.length>0){let r=o(e,t,["Loans","Primary credit","BTFP"]);if(r&&r.length>0){let t=c(e,r,["Week ended","Wednesday","Level","Averages of daily figures"]),i=c(e,r,["Change from week ended","Change from previous week","Change since"]);a=v(r,e,["Loans - Primary credit","Primary credit","Loans Primary credit","Primary credit loans"],t,l),v(r,e,["Loans - Primary credit","Primary credit","Loans Primary credit"],i,l),n=v(r,e,["Loans - Bank Term Funding Program","Bank Term Funding Program","BTFP","Loans BTFP"],t,l),v(r,e,["Loans - Bank Term Funding Program","Bank Term Funding Program","BTFP"],i,l),s=v(r,e,["Loans","Total loans","Loans total"],t,l),v(r,e,["Loans","Total loans"],i,l)}}if(r&&r.length>0){let t=o(e,r,["Memorandum Items","Securities lent","Overnight","Term"]);if(t&&t.length>0){let r=c(e,t,["Week ended","Level","Wednesday","Averages of daily figures"]);u=v(t,e,["Securities lent to dealers - Overnight facility","Overnight facility","Securities lent Overnight","Overnight"],r,l),d=v(t,e,["Securities lent to dealers - Term facility","Term facility","Securities lent Term","Term"],r,l)}}return{loans:{primaryCredit:a,btfp:n,total:s},securitiesLending:{overnight:u,term:d}}}(f,t);return{ok:!0,date:l,releaseDate:y||l,weekEnded:l,sections:{overview:C,factors:R,summary:A,maturity:L,lending:F,statement:function(e,l){let t=i(e,["Consolidated Statement of Condition","Table 5"]);if(!t||0===t.length)return l.push("Statement section not found"),S();let r=o(e,t,["Consolidated Statement","Statement of Condition"]);if(!r||0===r.length)return S();let a=c(e,r,["Assets","Level"]),n=c(e,r,["Change since","Change from previous week"]),s=c(e,r,["Change from year ago","Change from:"]),u=c(e,r,["Liabilities","Level"]),d=c(e,r,["Change since","Change from previous week"]),h=c(e,r,["Change from year ago","Change from:"]),f=["Gold certificate account","Gold stock","Gold"],y=["Special drawing rights certificate account","SDR certificate account","SDR"],g=["Securities held outright","Securities held","Securities"],p=["Repurchase agreements","Repos","Repurchase"],b=["Loans","Total loans"],w=["Central bank liquidity swaps","Central bank swaps","Liquidity swaps","Swaps"],m=["Total assets","Total"],k=["Federal Reserve notes","Currency in circulation","Currency","F.R. notes"],T=["Reverse repurchase agreements","Reverse repos","Reverse repurchase"],C=["Deposits with F.R. Banks, other than reserve balances","Deposits with F.R. Banks","Deposits other than reserve balances","Deposits","Other deposits"],R=["Reserve balances with Federal Reserve Banks","Reserve balances","Reserves","Reserve balances at Federal Reserve Banks"],A=["U.S. Treasury, General Account","Treasury General Account","Treasury, General Account","TGA","U.S. Treasury General Account","Treasury"],L=["Total liabilities","Total"];return{assets:{gold:v(r,e,f,a,l),sdr:v(r,e,y,a,l),securities:v(r,e,g,a,l),repos:v(r,e,p,a,l),loans:v(r,e,b,a,l),swaps:v(r,e,w,a,l),total:v(r,e,m,a,l),goldWeekly:v(r,e,f,n,l),goldYearly:v(r,e,f,s,l),sdrWeekly:v(r,e,y,n,l),sdrYearly:v(r,e,y,s,l),securitiesWeekly:v(r,e,g,n,l),securitiesYearly:v(r,e,g,s,l),reposWeekly:v(r,e,p,n,l),reposYearly:v(r,e,p,s,l),loansWeekly:v(r,e,b,n,l),loansYearly:v(r,e,b,s,l),swapsWeekly:v(r,e,w,n,l),swapsYearly:v(r,e,w,s,l),totalWeekly:v(r,e,m,n,l),totalYearly:v(r,e,m,s,l)},liabilities:{currency:v(r,e,k,u,l),reverseRepos:v(r,e,T,u,l),deposits:v(r,e,C,u,l),reserveBalances:v(r,e,R,u,l),tga:v(r,e,A,u,l),total:v(r,e,L,u,l),currencyWeekly:v(r,e,k,d,l),currencyYearly:v(r,e,k,h,l),reverseReposWeekly:v(r,e,T,d,l),reverseReposYearly:v(r,e,T,h,l),depositsWeekly:v(r,e,C,d,l),depositsYearly:v(r,e,C,h,l),reserveBalancesWeekly:v(r,e,R,d,l),reserveBalancesYearly:v(r,e,R,h,l),tgaWeekly:v(r,e,A,d,l),tgaYearly:v(r,e,A,h,l),totalWeekly:v(r,e,L,d,l),totalYearly:v(r,e,L,h,l)}}}(f,t)},warnings:t}}(n,e,t,y);if(p.warnings.length>0&&p.warnings.join("; ").length>800){let e=p.warnings.slice(0,Math.floor(.8*p.warnings.length));p.warnings.splice(0,p.warnings.length,...e),p.warnings.push(`[parseH41HTML] ... (${p.warnings.length-e.length} more warnings truncated)`)}return p}catch(l){return{ok:!1,date:e,releaseDate:"",weekEnded:"",sections:{overview:w(),factors:m(),summary:k(),maturity:T(),lending:R(),statement:S()},warnings:[l instanceof Error?l.message:String(l)]}}}function b(e,l,t,r,n,s,i,o,u,c,d){if(!l||0===l.length)return C();let h=l.find("td, th");return{within15Days:r>=0&&h.length>r?a(e(h[r]).text()):null,days16to90:n>=0&&h.length>n?a(e(h[n]).text()):null,days91to1Year:s>=0&&h.length>s?a(e(h[s]).text()):null,years1to5:i>=0&&h.length>i?a(e(h[i]).text()):null,years5to10:o>=0&&h.length>o?a(e(h[o]).text()):null,years10AndOver:u>=0&&h.length>u?a(e(h[u]).text()):null,total:c>=0&&h.length>c?a(e(h[c]).text()):null}}function v(e,l,t,r,s){if(r<0)return null;let i=u(l,e,function(e){let l=new Set;for(let t of e){l.add(t);let e=t.replace(/,/g,"");e!==t&&l.add(e);let r=t.replace(/[()]/g,"");r!==t&&l.add(r);let a=t.replace(/\s+/g," ");a!==t&&l.add(a);let n=t.replace(/[,()]/g,"").replace(/\s+/g," ");n!==t&&l.add(n)}return Array.from(l)}(t));if(!i||0===i.length){let r=e.find("tr");for(let e=0;e<r.length;e++){let a=l(r[e]),s=a.find("td, th").first().text().trim();for(let e of t){let l=n(e),t=n(s);if(t===l||t.includes(l)||l.split(/\s+/).filter(e=>e.length>3).every(e=>t.includes(e))){i=a;break}}if(i&&i.length>0)break}}if(!i||0===i.length)return null;let o=i.find("td, th");return o.length<=r?null:a(l(o[r]).text().trim())}function w(){return{totalAssets:null,securities:null,reserveBalances:null,tga:null,reverseRepos:null,currency:null,totalAssetsWeekly:null,totalAssetsYearly:null,securitiesWeekly:null,securitiesYearly:null,reserveBalancesWeekly:null,reserveBalancesYearly:null,tgaWeekly:null,tgaYearly:null,reverseReposWeekly:null,reverseReposYearly:null,currencyWeekly:null,currencyYearly:null,totalAssetsForComposition:null,treasurySecurities:null,mortgageBackedSecurities:null,otherAssets:null}}function m(){return{supplying:[],absorbing:[],totals:{totalSupplying:{value:null,weekly:null,yearly:null},totalAbsorbing:{value:null,weekly:null,yearly:null},reserveBalances:{value:null,weekly:null,yearly:null}}}}function k(){return{supplyingTop:[],absorbingTop:[]}}function T(){return{treasury:C(),mbs:C()}}function C(){return{within15Days:null,days16to90:null,days91to1Year:null,years1to5:null,years5to10:null,years10AndOver:null,total:null}}function R(){return{loans:{primaryCredit:null,btfp:null,total:null},securitiesLending:{overnight:null,term:null}}}function S(){return{assets:{gold:null,sdr:null,securities:null,repos:null,loans:null,swaps:null,total:null,goldWeekly:null,goldYearly:null,sdrWeekly:null,sdrYearly:null,securitiesWeekly:null,securitiesYearly:null,reposWeekly:null,reposYearly:null,loansWeekly:null,loansYearly:null,swapsWeekly:null,swapsYearly:null,totalWeekly:null,totalYearly:null},liabilities:{currency:null,reverseRepos:null,deposits:null,reserveBalances:null,tga:null,total:null,currencyWeekly:null,currencyYearly:null,reverseReposWeekly:null,reverseReposYearly:null,depositsWeekly:null,depositsYearly:null,reserveBalancesWeekly:null,reserveBalancesYearly:null,tgaWeekly:null,tgaYearly:null,totalWeekly:null,totalYearly:null}}}async function A(e,l){let t=e.replace(/-/g,""),r=`https://www.federalreserve.gov/releases/h41/${t}/`,a=await fetch(r,{headers:{"User-Agent":"Mozilla/5.0 (compatible; fedreportsh/1.0; +https://fedreportsh.vercel.app)",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9","Cache-Control":"no-cache",Pragma:"no-cache"},cache:"no-store",redirect:"follow"});404===a.status&&(r=`https://www.federalreserve.gov/releases/h41/${t}/default.htm`,a=await fetch(r,{headers:{"User-Agent":"Mozilla/5.0 (compatible; fedreportsh/1.0; +https://fedreportsh.vercel.app)",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8","Accept-Language":"en-US,en;q=0.9","Cache-Control":"no-cache",Pragma:"no-cache"},cache:"no-store",redirect:"follow"}));let n=a.headers.get("content-type")||"unknown",s=await a.text(),i=s.replace(/\s+/g," ").substring(0,500),o=["Access Denied","robot","captcha","Request Rejected","Forbidden"].some(e=>s.toLowerCase().includes(e.toLowerCase()));if(console.warn(`[fetchH41Report] Fetch result for ${t}:`,{url:r,status:a.status,statusText:a.statusText,contentType:n,htmlLength:s.length,htmlPreview:i,flagged:o}),!a.ok)throw Error(`Failed to fetch H.4.1 HTML: ${a.status} ${a.statusText}`);return o&&console.warn(`[fetchH41Report] WARNING: Blocked keywords detected in HTML for ${t}`),{html:s,url:r}}async function L(){let e=await fetch("https://www.federalreserve.gov/releases/h41/",{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"},cache:"no-store"});if(!e.ok)throw Error(`Failed to fetch H.4.1 main page: ${e.status}`);let l=await e.text(),t=r.zD(l),a=[];t('a[href*="/releases/h41/"]').each((e,l)=>{let r=(t(l).attr("href")||"").match(/\/releases\/h41\/(\d{8})\//);if(r){let e=r[1],l=`${e.slice(0,4)}-${e.slice(4,6)}-${e.slice(6,8)}`;a.push(l)}});let n=Array.from(new Set(a)).sort().reverse();if(0===n.length)throw Error("No release dates found");return n}}};